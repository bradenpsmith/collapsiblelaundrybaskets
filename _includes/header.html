<header class="site-header" role="banner">
  <div class="wrapper header-wrapper">
    <a class="site-logo" href="{{ '/' | relative_url }}">
      <img src="{{ '/assets/images/sitelogo.png' | relative_url }}" alt="{{ site.title }}" />
    </a>

    <!-- Hidden checkbox drives state -->
    <input id="nav-toggle" class="nav-toggle" type="checkbox" aria-label="Toggle navigation">

   <label for="nav-toggle" class="burger" role="button" aria-controls="site-nav" aria-expanded="false" tabindex="0">
  <svg viewBox="0 0 24 24" width="26" height="26" aria-hidden="true">
    <path d="M3 6h18M3 12h18M3 18h18" stroke="currentColor" stroke-width="2" stroke-linecap="round" fill="none"/>
  </svg>
</label>

    <nav id="site-nav" class="site-nav" aria-label="Primary">
     {% assign paths = site.header_pages %}
<ul>
  {% assign items = site.data.nav.items %}
  {% for item in items %}
    {% comment %} Resolve link + label from path/url {% endcomment %}
    {% assign link_url = item.url %}
    {% assign label = item.title %}
    {% if item.path %}
      {% assign p = site.pages | where: "path", item.path | first %}
      {% if p == nil %}
        {% for coll in site.collections %}
          {% assign d = coll.docs | where: "path", item.path | first %}
          {% if d %}{% assign p = d %}{% break %}{% endif %}
        {% endfor %}
      {% endif %}
      {% if p %}
        {% assign link_url = p.url | relative_url %}
        {% assign label = p.nav_title | default: p.title | default: p.data.nav_title | default: p.data.title | default: p.basename_without_ext %}
      {% endif %}
    {% endif %}

    {% assign has_children = item.children and item.children.size > 0 %}
    <li class="{% if has_children %}has-children{% endif %}">
      <a href="{{ link_url }}"
         {% if page.url == link_url %}aria-current="page" class="active"{% endif %}>
        {{ label }}
      </a>

      {% if has_children %}
        <button class="submenu-toggle" aria-haspopup="true" aria-expanded="false" tabindex="-1"></button>
        <ul class="submenu">
          {% for child in item.children %}
            {% assign c_url = child.url %}
            {% assign c_label = child.title %}
            {% if child.path %}
              {% assign cp = site.pages | where: "path", child.path | first %}
              {% if cp == nil %}
                {% for coll in site.collections %}
                  {% assign cd = coll.docs | where: "path", child.path | first %}
                  {% if cd %}{% assign cp = cd %}{% break %}{% endif %}
                {% endfor %}
              {% endif %}
              {% if cp %}
                {% assign c_url = cp.url | relative_url %}
                {% assign c_label = cp.nav_title | default: cp.title | default: cp.data.nav_title | default: cp.data.title | default: cp.basename_without_ext %}
              {% endif %}
            {% endif %}
            <li><a href="{{ c_url }}">{{ c_label }}</a></li>
          {% endfor %}
        </ul>
      {% endif %}
    </li>
  {% endfor %}
</ul>

    </nav>

    <!-- Click-outside scrim -->
    <label for="nav-toggle" class="nav-scrim" aria-hidden="true"></label>
  </div>
</header>

<!-- (Optional) tiny JS to keep aria-expanded in sync + Esc close -->
<script>
  (function(){
    const box = document.getElementById('nav-toggle');
    const btn = document.querySelector('.burger');
    function sync(){ btn && btn.setAttribute('aria-expanded', box && box.checked ? 'true' : 'false'); }
    document.addEventListener('click', sync);
    window.addEventListener('resize', sync);
    document.addEventListener('keydown', e => { if(e.key==='Escape' && box && box.checked){ box.checked=false; sync(); }});
    sync();
  })();
</script>
